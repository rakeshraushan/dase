<routes>
  <handler name="atom">
	<route action="get_post" auth="none">
	  <match caps="collection_ascii_id" param="post_id">app/collection/([^/]*)/post</match>
	</route>

	<route action="put_post" auth="none" method="put">
	  <match caps="collection_ascii_id" param="post_id">app/collection/([^/]*)/post</match>
	</route>

	<route action="delete_post" auth="none" method="delete">
	  <match caps="collection_ascii_id" param="post_id">app/collection/([^/]*)/post</match>
	</route>

	<route action="get_service" auth="none" mime="application/atomsvc+xml">
	  <match caps="collection_ascii_id">app/collection/([^/]*)/service</match>
	</route>

	<route action="get_categories_xml" auth="none">
	  <match caps="collection_ascii_id">app/collection/([^/]*)/categories</match>
	</route>

	<route action="get_posts" auth="none">
	  <match caps="collection_ascii_id">app/collection/([^/]*)/posts</match>
	  <match caps="collection_ascii_id" param="page">app/collection/([^/]*)/posts</match>
	</route>

	<route action="create_post" auth="none" method="post">
	  <match caps="collection_ascii_id">app/collection/([^/]*)/posts</match>
	</route>

	<route action="get_attachment" auth="none">
	  <match caps="collection_ascii_id">app/collection/([^/]*)/attachments</match>
	  <match caps="collection_ascii_id" param="page">app/collection/([^/]*)/attachments</match>
	</route>

	<route action="create_attachment" auth="none" method="post">
	  <match caps="collection_ascii_id">app/collection/([^/]*)/attachments</match>
	</route>

	<route action="get_file" auth="none">
	  <match caps="collection_ascii_id" param="post_id">app/collection/([^/]*)/attachment/file</match>
	</route>

	<route action="put_file" auth="none" method="put">
	  <match caps="collection_ascii_id" param="post_id">app/collection/([^/]*)/attachment/file</match>
	</route>

	<route action="delete_file" auth="none" method="delete">
	  <match caps="collection_ascii_id" param="post_id">app/collection/([^/]*)/attachment/file</match>
	</route>

	<route action="get_attachment" auth="none">
	  <match caps="collection_ascii_id" param="post_id">app/collection/([^/]*)/attachment</match>
	</route>

	<route action="put_attachment" auth="none" method="put">
	  <match caps="collection_ascii_id" param="post_id">app/collection/([^/]*)/attachment</match>
	</route>

	<route action="delete_attachment" auth="none" method="delete">
	  <match caps="collection_ascii_id" param="post_id">app/collection/([^/]*)/attachment</match>
	</route>
  </handler>

  <handler name="collection">
	<route action="listAll" auth="none">
	  <match>collection/list</match>
	  <match>collections</match>
	  <match>home</match>
	  <match></match>
	</route>

	<route action="asAtom" auth="none" mime="application/atom+xml">
	  <match params="collection_ascii_id">atom/collection</match>
	</route>

	<route action="listAsAtom" auth="none" mime="application/atom+xml">
	  <match>atom</match>
	  <match>atom/collections</match>
	</route>

	<route action="attributesAsAtom" auth="none">
	  <match caps="collection_ascii_id">atom/collection/([^/]*)/attributes/public</match>
	</route>

	<route action="attributesAsHtml" auth="none">
	  <match caps="collection_ascii_id">collection/([^/]*)/attributes/public</match>
	</route>

	<route action="adminAttributesAsHtml" auth="none">
	  <match caps="collection_ascii_id">collection/([^/]*)/attributes/admin</match>
	</route>

	<route action="browse" auth="user">
	  <match params="collection_ascii_id">collection</match>
	</route>

	<route action="itemTalliesAsJson" auth="none" mime="application/json">
	  <match>json/item_tallies</match>
	</route>

	<route action="attributeTalliesAsJson" auth="user" mime="application/json">
	  <match caps="collection_ascii_id">json/collection/([^/]*)/attribute_tallies</match>
	</route>

	<route action="adminAttributeTalliesAsJson" auth="user" mime="application/json">
	  <match caps="collection_ascii_id">json/collection/([^/]*)/admin_attribute_tallies</match>
	</route>

	<route action="buildIndex" auth="admin" params="collection_ascii_id"/>

	<route action="attributesAsJson" auth="user" mime="application/json">
	  <match caps="collection_ascii_id">json/collection/([^/]*)/attributes</match>
	</route>

  </handler>

  <handler name="search">
	<!-- note search_item MUST precede search -->
	<route action="itemAsAtom" auth="none" mime="application/atom+xml">
	  <match caps="collection_ascii_id">atom/collection/([^/]*)/search_item</match>
	  <match>atom/search_item</match>
	</route>

	<route action="opensearch" auth="none" mime="application/atom+xml">
	  <match caps="collection_ascii_id">atom/collection/([^/]*)/search</match>
	  <match>atom/search</match>
	  <match params="md5_hash">atom/search/md5</match>
	</route>

	<!-- note search_item MUST precede search -->
	<route action="item" auth="user">
	  <match caps="collection_ascii_id">collection/([^/]*)/search_item</match>
	  <match>search_item</match>
	</route>

	<route action="search" auth="user">
	  <match caps="collection_ascii_id">collection/([^/]*)/search</match>
	  <match params="md5_hash">search/md5</match>
	  <match>search</match>
	</route>

	<route action="sql" auth="superuser">
	  <match>sql/search</match>
	  <match caps="collection_ascii_id">sql/collection/([^/]*)/search</match>
	</route>
  </handler>

  <handler name="tag">
	<route action="asAtom" auth="token" mime="application/atom+xml">
	  <match caps="eid" params="id">atom/user/([^/]*)/tag/id</match>
	</route>

	<!-- note that I created a second stanza w/o auth-->
	<route action="asAtom" auth="none" mime="application/atom+xml">
	  <match caps="eid" params="ascii_id">atom/user/([^/]*)/tag</match>
	</route>
  </handler>

  <handler name="item">
	<route action="asAtom" auth="none" mime="application/atom+xml">
	  <match caps="collection_ascii_id" params="serial_number">atom/collection/([^/]*)</match>
	</route>

	<route action="display" auth="user">
	  <match caps="collection_ascii_id" params="serial_number">collection/([^/]*)</match>
	</route>

  </handler>

  <handler name="user">
	<!-- NOTE: eid should always be preceded by 'user' in regex -->
	<route action="dataAsJson" auth="eid" mime="application/json" nocache="custom">
	  <match caps="eid">json/user/([^/]*)/data</match>
	</route>

	<route action="cartAsJson" auth="eid" mime="application/json">
	  <match caps="eid">json/user/([^/]*)/cart</match>
	</route>

	<route action="adminCollectionsAsJson" auth="eid" mime="application/json">
	  <match caps="eid">json/user/([^/]*)/collections</match>
	</route>

	<!-- initiate login process (it'll delegate to module) -->
	<route action="initiateLogin" auth="none">
	  <match>login</match>
	</route>

	<!-- accept GET from module at '/login/{eid}' -->
	<route action="finishLogin" auth="none">
	  <match params="eid">login</match>
	</route>

	<route action="logoff" auth="none">
	  <match>logoff</match>
	</route>

	<route action="addCartItem" auth="eid" method="post">
	  <match caps="eid">user/([^/]*)/cart</match>
	</route>

	<route action="deleteTagItem" auth="eid" method="delete">
	  <match caps="eid" params="tag_item_id">user/([^/]*)/tag_items</match>
	</route>

	<route action="tag" auth="eid">
	  <match caps="eid" params="id">user/([^/]*)/tag/id</match>
	  <match caps="eid" params="ascii_id">user/([^/]*)/tag</match>
	</route>

	<route action="cart" auth="eid">
	  <match caps="eid">user/([^/]*)/cart</match>
	</route>

	<route action="settings" auth="eid">
	  <match caps="eid">user/([^/]*)</match>
	</route>

  </handler>

  <handler name="attribute">
	<route action="attributeValuesAsHtml" auth="none">
	  <match caps="collection_ascii_id/attribute_ascii_id">collection/([^/]*)/attribute/([^/]*)</match>
	</route>

  </handler> <!-- end attribute handler-->

  <handler name="manage">

	<route action="checkRoutes" auth="superuser">
	  <match>badroutes</match>
	</route>

	<route action="exec" auth="superuser">
	  <match>manage/exec</match>
	</route>

	<route action="viewLog" auth="superuser">
	  <match params="log_name">manage/log</match>
	</route>

	<route action="index" auth="superuser">
	  <match>manage</match>
	</route>

	<route action="modules" auth="superuser">
	  <match>manage/modules</match>
	</route>

	<route action="routes" auth="superuser">
	  <match>manage/routes</match>
	</route>

	<route action="phpinfo" auth="superuser">
	  <match>phpinfo</match>
	</route>

	<route action="stats" auth="superuser">
	  <match>manage/stats</match>
	</route>

  </handler>

  <handler name="admin">

	<route action="index" auth="admin">
	  <!-- ALL admin calls begin thusly: -->
	  <match params="eid/collection_ascii_id">admin</match>
	</route>

	<route action="setAttributeSortOrder" auth="admin" method="put">
	  <!-- note: new sort order must be included in body of message -->
	  <match caps="eid/collection_ascii_id/attribute_ascii_id">admin/([^/]*)/([^/]*)/attribute/([^/]*)/sort_order</match>
	</route>

	<route action="dataAsJson" auth="read" mime="application/json" nocache="custom">
	  <match caps="collection_ascii_id">json/collection/([^/]*)/data</match>
	  <match caps="collection_ascii_id" params="select">json/collection/([^/]*)/data</match>
	</route>
  </handler>

  <handler name="widget">
	<route action="init" auth="none" mime="application/x-javascript">
	  <match>scripts/widgets.js</match>
	</route>
  </handler>

  <handler name="css">
	<route action="init" auth="none" mime="text/css">
	  <match>css/dynamic.css</match>
	</route>
  </handler>

</routes>
