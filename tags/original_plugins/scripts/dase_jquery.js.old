if (!Dase) { var Dase = {}; }

$(function(){ 
		Dase.listMenu();
		Dase.multicheck("checkedCollection");
		Dase.getItemTallies();
		Dase.prepareBrowse();
		}); 

Dase.listMenu = function() { 
	$("ul#menu").find("li/ul").hide().end().find("li[ul]").find("a:eq(0)").click(function() {
			$(this).find('../ul').toggle();
			return false;
			});
}

Dase.multicheck = function(c) { 
	$("ul.multicheck").append("<a href='' class='chk'>check all</a><a href='' class='unchk'>uncheck all</a>").find("input:checkbox").click( function() { $(this).parent().toggleClass(c);}).filter("@checked=checked").parent().addClass(c);
	$(".chk").hide().click(function() { 
			$(this).hide().next().show().parent().find("input:checkbox").attr("checked",true).parent().addClass(c);
			return false;
			});
	$(".unchk").click(function() { 
			$(this).hide().prev().show().parent().find("input:checkbox").removeAttr("checked").parent().removeClass(c);
			return false;
			});
}

Dase.getItemTallies = function() {
	if ($("#collectionList").size()) {
		$.get("ajax/item_tallies",function(data){
				$("collection",data).each(function() {
					$('#tally-'+$(this).attr("id")).text("(" + $(this).attr('item_tally') + ")");
					});
				});
	}
}

Dase.prepareBrowse = function() {
	if($("#browseColumns").size()) {
		var params = $("#browseColumns").attr("class").split(" ");
		var collection_id = params[0];
		var public_only = params[1];
		Dase.getAttributes(0,collection_id,public_only);
		$("#catColumn").find("a").each(function() {
				var category_id = $(this).attr("id").split('_').pop(); //creates closure for click event
				$(this).click(function() {
					$("#attColumn").removeClass();
					$('#valColumn').html(" ").attr("class","empty");
					if ('admin' == category_id) {
					Dase.getAdminAttributes(collection_id);
					} else {
					Dase.getAttributes(category_id,collection_id,public_only);
					}
					return false;
					});
				});
	}
}

Dase.getAttributes = function(cat_id,collection_id,public_only) {
	var params = {
	   token: new Date().getTime(),
	   link_class: "att_link",
	   collection_id: collection_id,
	   cat_id: cat_id,
	   public_only: public_only
	};	   
	$("#catColumn/a[@class=spill]").attr("class","catLink");
	$("#catLink_"+cat_id).attr("class","spill");
	$("#attColumn").html("<div class='loading'>Loading Attributes...</div>");
	$.get("ajax/attributes_by_category",params,function(data) {
			$("#attColumn").html(data);
			Dase.bindGetValues(collection_id);
			});
	if ($("#attColumn").attr("class")) {
		//meaning there is an attr_id embedded in the className of attColumn
		$("#valColumn").removeClass();
	} else {
		$('#valColumn').html(" ").attr("class","empty");
	}
	$('#autocomplete').html(" ");
}

Dase.getAdminAttributes = function(collection_id) {
	var params = {
	   token: new Date().getTime(),
	   link_class: "att_link",
	   collection_id: collection_id
	};	   
	$("#catColumn/a[@class=spill]").attr("class","catLink");
	$("#catLink_admin").attr("class","spill");
	$("#attColumn").html("<div class='loading'>Loading Admin Attributes...</div>");
	$.get("ajax/admin_attributes",params,function(data) {
			$("#attColumn").html(data);
			Dase.bindGetValues(collection_id);
			});
	if ($("#attColumn").attr("class")) {
		//meaning there is an attr_id embedded in the className of attColumn
		$("#valColumn").removeClass();
	} else {
		$('#valColumn').html(" ").attr("class","empty");
	}
	$('#autocomplete').html(" ");
}

Dase.bindGetValues = function(collection_id) {
	$("#attColumn").find('a').each(function() {
			var attribute_id = $(this).attr("class").split(" ").pop(); //creates closure for click event
			$(this).click(function() {
				var params = {
					token: new Date().getTime(),
					attribute_id: attribute_id,
					collection_id: collection_id
					};	   
					$("#attColumn//a[@class=spill]").attr("class","att_link");
					$("#att_link_"+attribute_id).attr("class","spill");
					$("#valColumn").html("<div class='loading'>Loading Values...</div>");
					$.get("ajax/values_by_attribute",params,function(data) {
						$("#valColumn").html(data).removeClass();
						});
					$('#autocomplete').html(" ");
					window.scroll(0,0);
					return false;
					});
			});
	Dase.getAttributeTallies(collection_id);
}

Dase.getAttributeTallies = function(coll_id) {
	if ($("#getTallies").size()) {
		var params = {
         token: new Date().getTime(),
		 coll_id: coll_id
		};	   
		if ('adminAtts' == $('#getTallies').attr("class")) { 
			params.admin = 1;
		}
		if ($('#currently_using_cb').size()) {
			params.cb=1;
		}
		$.get("ajax/attribute_tallies",params,function(data) {
				$("attribute",data).each(function() {
					$('#tally-'+$(this).attr("id")).text("(" + $(this).attr('val_tally') + ")");
					});

				});
	}
}
